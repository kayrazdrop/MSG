<!DOCTYPE html>
<html>
<head>
  <title>Mass Transfer Token</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>
<body>
  <h2>Mass Transfer Token</h2>

  <button onclick="connectWallet()">ğŸ”Œ Connect Wallet</button>
  <p id="walletAddress">Wallet: <i>Not connected</i></p>

  <label>Token Contract Address:</label><br>
  <input type="text" id="tokenAddress" size="60"><br><br>

  <label>Recipients (comma-separated):</label><br>
  <textarea id="recipients" rows="5" cols="60"></textarea><br><br>

  <label>Amounts (comma-separated, dalam token):</label><br>
  <textarea id="amounts" rows="5" cols="60"></textarea><br><br>

  <button onclick="massTransfer()">ğŸš€ Mass Transfer</button>

  <p id="status"></p>

  <script>
    let provider;
    let signer;

    const abi = [
      "function massTransfer(address[] calldata _recipients, uint256[] calldata _amounts) public returns (bool)",
      "function decimals() public view returns (uint8)"
    ];

    async function connectWallet() {
      if (typeof window.ethereum === 'undefined') {
        alert('MetaMask / Web3 wallet not detected!');
        return;
      }

      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      const address = await signer.getAddress();
      document.getElementById("walletAddress").innerText = "Wallet: " + address;
    }

    async function massTransfer() {
      if (!signer) {
        alert('âš ï¸ Please connect your wallet first.');
        return;
      }

      const tokenAddress = document.getElementById("tokenAddress").value;
      const contract = new ethers.Contract(tokenAddress, abi, signer);

      const recipients = document.getElementById("recipients").value.split(",").map(s => s.trim());
      const amountsRaw = document.getElementById("amounts").value.split(",").map(s => s.trim());

      try {
        const decimals = await contract.decimals();
        const amounts = amountsRaw.map(a => ethers.utils.parseUnits(a, decimals));

        const tx = await contract.massTransfer(recipients, amounts);
        document.getElementById("status").innerText = "â³ Transaction sent: " + tx.hash;
        await tx.wait();
        document.getElementById("status").innerText = "âœ… Success! Tx Hash: " + tx.hash;
      } catch (e) {
        document.getElementById("status").innerText = "âŒ Error: " + e.message;
      }
    }
  </script>
</body>
</html>
